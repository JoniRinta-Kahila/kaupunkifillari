{"version":3,"sources":["mst/rootStoreContext.ts","components/main.tsx","components/stationInfo.tsx","mst/index.ts","mst/setup.ts","context/bikeStationUpdateProvider.tsx","App.tsx","index.tsx","components/stationInfo.module.scss","App.module.scss"],"names":["defaultObj","RootStoreContext","createContext","RootStoreProvider","Provider","useStores","store","useContext","Error","Main","observer","stations","useState","redirectTo","setRedirectTo","to","className","styles","container","style","color","textAlign","Autocomplete","disablePortal","onChange","e","target","textContent","id","options","map","x","name","filter","value","index","self","indexOf","sx","width","background","renderInput","params","TextField","label","StationInfo","station","setStation","getSnapshot","snap","setSnap","onSnapshot","newSnapshot","stationReq","useParams","stationName","useEffect","find","bikesAvailable","active","StationModel","t","model","string","lat","number","lon","spacesAvailable","boolean","RootStoreModel","bikeRentalStations","array","actions","fetchStationDataAsync","flow","fetch","method","headers","response","text","dataText","data","JSON","parse","ok","replace","console","error","STORAGE_KEY","BikeStationUpdateProvider","children","log","intervall","setInterval","info","clearInterval","App","rootTree","setRootTree","storeProcessor","types","snapshotProcessor","postProcessor","localStorage","getItem","create","snapshot","setItem","stringify","setupRootStore","exact","path","component","ReactDOM","render","StrictMode","document","getElementById","module","exports"],"mappings":"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","file":"static/js/main.a03ccf6d.chunk.js","sourcesContent":["import { createContext, useContext } from \"react\"\nimport { RootStore } from \"../mst\"\n\n// This is an dummy object instantiated only for detecting when provider is missing.\n// In this approach we are basically forbidding usage of default values in this context,\n// which seems to line up quite well with most real-life scnearios for application state management.\n// For default values for the stores, that should be done at the provider (app.tsx).\nconst defaultObj: any = {}\nconst RootStoreContext = createContext<RootStore>(defaultObj) \n\nexport const RootStoreProvider = RootStoreContext.Provider\n\nexport const useStores = () => {\n  const store = useContext(RootStoreContext)\n  if(store === defaultObj) {\n    throw new Error(\"RootStore Consumer present without provider! This likely implies mistake in code, make sure that you have provider somewhere lower in the component tree (usually at or near app.tsx).\")\n  }\n  return store\n}\n","import { Autocomplete, TextField } from '@mui/material';\nimport React, { useState } from 'react';\nimport styles from './main.module.scss';\nimport { observer } from 'mobx-react-lite';\nimport { useStores } from '../mst/rootStoreContext';\nimport { Redirect } from 'react-router';\n\nconst Main: React.FC = observer(() => {\n  const { stations} = useStores();\n  const [redirectTo, setRedirectTo] = useState<string>();\n\n  if (redirectTo) return <Redirect to={`station/${redirectTo}`} />\n\n  const onlyUnique = (value:any, index:any, self: any) => {\n    return self.indexOf(value) === index;\n  }\n\n  return (\n    <div className={styles.container}>\n      <h1 style={{color:'azure', textAlign:'center'}}>Kaupunkifillarit</h1>\n      <Autocomplete\n        disablePortal\n        onChange={(e:any) => setRedirectTo(e.target.textContent)}\n        id=\"combo-box-demo\"\n        options={stations.map(x => x.name).filter(onlyUnique)}\n        sx={{ width: 300, background:'azure' }}\n        renderInput={(params) => <TextField {...params} label=\"Valitse polkupyöräasema\" />}\n      />\n    </div>\n  )\n})\n\nexport default Main;\n","import React, { useEffect, useState } from 'react';\nimport { Link, useParams } from \"react-router-dom\";\nimport styles from './stationInfo.module.scss';\nimport { observer } from 'mobx-react-lite';\nimport { useStores } from '../mst/rootStoreContext';\nimport { RootStoreSnapshot, Station } from '../mst';\nimport { getSnapshot, onSnapshot } from 'mobx-state-tree';\n\nconst StationInfo: React.FC = observer(() => {\n  const [station, setStation] = useState<Station>();\n  const [snap, setSnap] = useState<RootStoreSnapshot>(getSnapshot(useStores()));\n  onSnapshot(useStores(), (newSnapshot) => setSnap(newSnapshot));\n\n  const params = useParams<any>();\n  const stationReq: string = params.stationName;\n\n  useEffect(() => {\n    setStation(snap.stations.find(x => x.name === stationReq))\n  }, [snap.stations, stationReq]);\n\n  return !!station\n  ? (\n      <div className={styles.container}>\n        <h1 style={{color: 'azure'}}>{station.name}</h1>\n        <p\n          style={\n            station.bikesAvailable < 1\n            ? {color: 'red'}\n            : {color: 'snow'}\n          }\n        >\n          Fillareita vapaana {station.bikesAvailable}\n           {/* / {station.spacesAvailable} */}\n        </p>\n        <p style={station.active ? {color: 'greenyellow'} : {color:'red'}}>Asema {station.active ? 'on käytössä': 'ei ole käytössä'}</p>\n        <button>\n          <Link to='/'> Valitse toinen asema </Link>\n        </button>\n      </div>\n    )\n  : (\n      <div>\n        <p>NO_DATA</p>\n      </div>\n    )\n})\n\nexport default StationInfo;\n","import {\n  Instance,\n  SnapshotOut,\n  types as t,\n  flow\n} from 'mobx-state-tree';\n\nexport const StationModel = t.model('Station', {\n  id: t.string,\n  lat: t.number,\n  lon: t.number,\n  name: t.string,\n  bikesAvailable: t.number,\n  spacesAvailable: t.number,\n  active: t.boolean,\n});\n\nexport const StationsModel = t.model('Stations', {\n  bikeRentalStations: t.array(StationModel),\n})\n\nexport const RootStoreModel = t\n  .model('Root', {\n    stations: t.array(StationModel),\n  })\n  .actions(self => ({\n    fetchStationDataAsync: flow(function* () {\n      try {\n        const response: Response = yield fetch('https://us-central1-kaupunkifillarit-aed04.cloudfunctions.net/api/getStations', {\n          method: 'GET',\n          headers: {\n            'Content-Type': 'application/json',\n          }\n        });\n        const dataText = yield response.text();\n        const data: Stations = JSON.parse(dataText);\n        if (response.ok) {\n          self.stations.replace(data.bikeRentalStations);\n          return;\n        }\n        console.error('NOTHING TO FETCH');\n      } catch (err) {\n        console.error('MST:', err);\n      }\n    })\n  }));\n\nexport interface Station extends Instance<typeof StationModel> { };\nexport interface StationSnapshot extends SnapshotOut<typeof StationModel> { };\n\nexport interface Stations extends Instance<typeof StationsModel> { };\nexport interface StationSnapshot extends SnapshotOut<typeof StationsModel> { };\n\nexport interface RootStore extends Instance<typeof RootStoreModel> { };\nexport interface RootStoreSnapshot extends SnapshotOut<typeof RootStoreModel> { };\n","import { onSnapshot, types } from \"mobx-state-tree\";\nimport { RootStore, RootStoreModel } from \".\";\n\nconst STORAGE_KEY = 'ROOT_STORE';\n\nexport const setupRootStore = () => {\n  let store: RootStore;\n  let data: any;\n\n  const storeProcessor = types.snapshotProcessor(RootStoreModel, {\n    postProcessor: x => {\n      const copy = {...x} as any;\n      return copy;\n    },\n  });\n\n  try {\n    data = JSON.parse(localStorage.getItem(STORAGE_KEY) ?? '{}');\n    store = storeProcessor.create(data);\n  } catch (error) {\n    console.error('MST ERROR:', error)\n    store = storeProcessor.create();\n  }\n\n  onSnapshot(store, snapshot => localStorage.setItem(STORAGE_KEY, JSON.stringify(snapshot)));\n  return store;\n}","import React, { useEffect } from 'react';\nimport { useStores } from '../mst/rootStoreContext';\n\nconst BikeStationUpdateProvider: React.FC = ({children}) => {\n\n  const { fetchStationDataAsync } = useStores();\n  \n  useEffect(() => {\n    console.log('USEEFFECT')\n    fetchStationDataAsync();\n    const intervall = setInterval(() => {\n      console.info('Updating data...');\n      fetchStationDataAsync();\n    }, 60000);\n    return () => clearInterval(intervall);    \n  }, [fetchStationDataAsync]);\n\n  return (\n    <div>\n      {children}\n    </div>\n  )\n}\n\nexport default BikeStationUpdateProvider;\n","import React, { useEffect, useState } from 'react';\nimport { Route, Switch } from 'react-router-dom';\nimport Main from './components/main';\nimport StationInfo from './components/stationInfo';\nimport styles from './App.module.scss';\nimport { RootStore } from './mst';\nimport { setupRootStore } from './mst/setup';\nimport { RootStoreProvider } from './mst/rootStoreContext';\nimport BikeStationUpdateProvider from './context/bikeStationUpdateProvider';\n\nconst App: React.FC = () => {\n  const [rootTree, setRootTree] = useState<RootStore|undefined>();\n  useEffect(() => {\n    setRootTree(setupRootStore());\n  }, []);\n\n  if (!rootTree) return null; //activityindicator;\n\n  return (\n    <RootStoreProvider value={rootTree}>\n      <BikeStationUpdateProvider>\n        <div className={styles.container}>\n          <Switch>\n            <Route exact path='/' component={Main} />\n            <Route exact path='/station/:stationName' component={StationInfo} />\n          </Switch>\n        </div>\n      </BikeStationUpdateProvider>\n    </RootStoreProvider>\n  )\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport App from './App';\nimport { HashRouter } from 'react-router-dom';\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n      <App />\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById('root')\n);\n","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"stationInfo_container__3H6VT\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"container\":\"App_container__eSJ6i\"};"],"sourceRoot":""}